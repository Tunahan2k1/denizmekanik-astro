---
import Layout from '../../layouts/Layout.astro';
import allProducts from '../../data/urunler.json';
import allProductGroups from '../../data/urun-gruplari.json';
import { Fragment } from 'astro/jsx-runtime';

// Bu fonksiyon, urunler.json dosyasındaki her bir ürün için bir sayfa oluşturur.
export async function getStaticPaths() {
  return allProducts.map(product => ({
    params: { urun_slug: product.slug }, // URL'yi belirler
    props: { product }, // Sayfaya o ürüne ait veriyi gönderir
  }));
}

const { product } = Astro.props;
const group = allProductGroups.find(g => g.id === product.urun_grup_id);
const similarProducts = allProducts.filter(p => p.urun_grup_id === product.urun_grup_id && p.id !== product.id).slice(0, 4);
---

<Layout title={`${product.ad} | Deniz Mekanik`}>

  <Fragment slot="head">
    <meta name="description" content={product.seo_aciklama} />
    <meta name="keywords" content={`${product.ad}, ${group ? group.ad : 'vinç'}, vinç imalatı, Deniz Mekanik`} />
    <link rel="canonical" href={`https://www.denizmekanik.com/urun/${product.slug}`} />
    
    {/* Open Graph & Twitter Card */}
    <meta property="og:title" content={`${product.ad} | Deniz Mekanik`} />
    <meta property="og:description" content={product.seo_aciklama} />
    <meta property="og:type" content="product" />
    <meta property="og:url" content={`https://www.denizmekanik.com/urun/${product.slug}`} />
    <meta property="og:image" content={`https://www.denizmekanik.com${product.resim}`} />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={`${product.ad} | Deniz Mekanik`} />
    <meta name="twitter:description" content={product.seo_aciklama} />
    <meta name="twitter:image" content={`https://www.denizmekanik.com${product.resim}`} />

    {/* Ürüne özel Schema.org Yapısal Verisi */}
    <script type="application/ld+json" is:inline>
    {
      "@context": "https://schema.org",
      "@type": "Product",
      "name": `${product.ad}`,
      "image": `https://www.denizmekanik.com${product.resim}`,
      "description": `${product.seo_aciklama}`,
      "brand": { "@type": "Brand", "name": "Deniz Mekanik" },
      "offers": {
        "@type": "Offer",
        "priceCurrency": "TRY",
        "availability": "https://schema.org/InStock",
        "seller": { "@type": "Organization", "name": "Deniz Mekanik" }
      }
    }
    </script>
  </Fragment>

  <div class="container mt-5">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb bg-transparent p-0">
        <li class="breadcrumb-item"><a href="/">Ana Sayfa</a></li>
        <li class="breadcrumb-item"><a href="/urun-gruplari">Ürün Grupları</a></li>
        {group && <li class="breadcrumb-item"><a href={`/urunler/${group.slug}`}>{group.ad}</a></li>}
        <li class="breadcrumb-item active" aria-current="page" style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">{product.ad}</li>
      </ol>
    </nav>
    <h1 style="text-align: center;">{product.ad}</h1>
    <div class="row mt-4">
      <div class="col-lg-6 mb-4 mb-lg-0">
          <div class="card h-100 shadow-sm">
              <img src={product.resim} class="card-img-top p-3" alt={product.ad} style="object-fit: contain; height: 450px;">
              <div class="card-body">
                  <h1 class="h4 card-title">{product.ad}</h1>
                  <p class="card-text">{product.seo_aciklama}</p>
              </div>
          </div>
      </div>
      <div class="col-lg-6">
          <div class="card h-100 shadow-sm">
              <div class="card-header bg-primary text-white"><h2 class="h5 mb-0">Teknik Özellikler</h2></div>
              <div class="card-body">
                  <ul class="list-group list-group-flush">
                    {product.ozellikler.map(ozellik => <li class="list-group-item">{ozellik}</li>)}
                  </ul>
              </div>
              <div class="card-footer text-center">
                <h4 class="h6">Teklif Almak İçin Bize Ulaşın</h4>
                <div class="btn-group mt-2" role="group">
                  <a href={`https://wa.me/905326948116?text=${encodeURIComponent(product.ad + ' hakkında bilgi almak istiyorum')}`} class="btn btn-success"><i class="fab fa-whatsapp mr-2"></i>WhatsApp</a>
                  <a href="tel:+905326948116" class="btn btn-primary"><i class="fas fa-phone mr-2"></i>Ara</a>
                  <a href={`/iletisim?konu=Teklif İsteği: ${encodeURIComponent(product.ad)}`} class="btn btn-outline-secondary"><i class="fas fa-file-invoice mr-2"></i>Teklif Formu</a>
                </div>
              </div>
          </div>
      </div>
    </div>

    {similarProducts.length > 0 && (
      <div class="row mt-5">
        <div class="col-12">
          <h3 class="mb-4">Benzer Ürünler</h3>
          <div class="row">
            {similarProducts.map(similar => (
              <div class="col-lg-3 col-md-6 mb-4">
                <div class="card h-100 shadow-sm">
                  <a href={`/urun/${similar.slug}`}>
                    <img src={similar.resim} class="card-img-top" alt={similar.ad} style="height: 150px; object-fit: contain; padding: 10px;" />
                  </a>
                  <div class="card-body d-flex flex-column">
                    <h6 class="card-title small">{similar.ad}</h6>
                    <a href={`/urun/${similar.slug}`} class="btn btn-sm btn-outline-primary mt-auto">Detayları Gör</a>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    )}

    {group && (
      <div class="row mt-4">
        <div class="col-12 text-center">
          <a href={`/urunler/${group.slug}`} class="btn btn-primary">
            <i class="fas fa-list mr-2"></i> {group.ad} Kategorisine Dön
          </a>
        </div>
      </div>
    )}
  </div>
</Layout>